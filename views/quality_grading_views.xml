<!-- This XML file defines the user interface components for the Quality Grading module:
     1. Menu Structure: Creates a "Quality" menu under Purchases with a submenu for "Quality Grading Reports"
     2. Action Window: Defines how the quality grading records will be displayed (tree/form views)
     3. Tree View: Lists quality grading records in a table format showing key information
     4. Form View: Detailed view for creating/editing quality grading reports with:
        - Header information (PO, Product, Date, etc.)
        - Grading quantities and summary
        - Detailed grading characteristics in a notebook tab
        - Image attachments tab
        - Chatter for communication tracking
-->

<odoo>
    <data>
        <menuitem id="menu_quality_root" 
                  name="Quality" 
                  parent="purchase.menu_purchase_root" 
                  sequence="25"/>

        <record id="action_quality_grading_report" model="ir.actions.act_window">
            <field name="name">Quality Grading Reports</field>
            <field name="res_model">custom.quality.grading</field>
            <field name="view_mode">tree,form</field>
            <field name="help" type="html">
                <p class="o_view_nocontent_smiling_face">
                    Create a new Quality Grading Report
                </p>
            </field>
        </record>
        
        <menuitem id="menu_quality_grading" 
                  name="Quality Grading Reports" 
                  parent="menu_quality_root" 
                  action="action_quality_grading_report" 
                  sequence="10"/>

        <record id="view_quality_grading_tree" model="ir.ui.view">
            <field name="name">custom.quality.grading.tree</field>
            <field name="model">custom.quality.grading</field>
            <field name="arch" type="xml">
                <tree string="Quality Grading Reports">
                    <field name="name"/>
                    <field name="purchase_order_id"/>
                    <field name="product_id"/>
                    <field name="receipt_date"/>
                    <field name="qty_received"/>
                    <field name="qty_total_graded"/>
                    <field name="tester_id"/>
                    <field name="test_location_id"/> 
                </tree>
            </field>
        </record>

        <record id="view_quality_grading_form" model="ir.ui.view">
            <field name="name">custom.quality.grading.form</field>
            <field name="model">custom.quality.grading</field>
            <field name="arch" type="xml">
                <form string="Quality Grading Report">
                    <header>
                        </header>
                    <sheet>
                        <!-- Add the invisible field here -->
                        <field name="available_lot_ids" invisible="1"/>
                        <div class="oe_title">
                            <h1><field name="name" readonly="1"/></h1>
                        </div>
                        <group>
                            <group>
                                <field name="purchase_order_id"/>
                                <field name="product_id"/>
                                <field name="uom_id" readonly="1" groups="uom.group_uom"/>
                                <field name="parent_lot_id"/> 
                            </group>
                            <group>
                                <field name="receipt_date"/>
                                <field name="tester_id"/>
                                <field name="test_location_id"/>
                            </group>
                        </group>
                        
                        <separator string="Grading Summary"/>
                        <group>
                            <field name="qty_received"/>
                            <field name="notes" placeholder="Enter general remarks, conclusions, or required follow-up actions here..."/>
                        </group>
                        <group>
                            <group string="Quantities Graded">
                                <field name="qty_grade_a"/>
                                <field name="qty_grade_b"/>
                                <field name="qty_grade_c"/>
                            </group>
                            <group string="Validation">
                                <field name="qty_total_graded" decoration-success="qty_total_graded == qty_received"/>
                            </group>
                        </group>

                         <notebook>
                        <page string="Graded Product Characteristics and Valuation">
                            <field name="test_line_ids">
                                <tree editable="bottom">
                                    <field name="grade_type" required="1"/> 
                                    
                                    <field name="uniform_color"/>
                                    <field name="visible_mold"/>
                                    <field name="physical_damage"/>
                                    <field name="pest_free"/>
                                    <field name="freshness"/>
                                    <field name="texture"/>
                                    <field name="aroma"/>
                                    
                                    <field name="moisture" widget="percentage"/>
                                    
                                    <field name="qty_of_grade" readonly="1" string="Qty (Kg)"/>
                                    
                                    <field name="rate_per_kg"/>
                                    <field name="total_amount" readonly="1"/>
                                </tree>
                            </field>
                        </page>
                        <page string="Attached Images">
                            <field name="image_ids" mode="kanban,tree">
                                <kanban>
                                    <field name="name"/>
                                    <field name="location"/>
                                    <field name="image"/>
                                    <templates>
                                        <t t-name="kanban-box">
                                            <div t-attf-class="oe_kanban_global_click">
                                                <div class="o_kanban_image">
                                                    <img alt="Image" t-att-src="kanban_image('custom.quality.image', 'image', record.id.raw_value)"/>
                                                </div>
                                                <div class="oe_kanban_details">
                                                    <strong><field name="name"/></strong>
                                                    <div>Location: <field name="location"/></div>
                                                </div>
                                            </div>
                                        </t>
                                    </templates>
                                </kanban>
                                <form>
                                    <group>
                                        <field name="name"/>
                                        <field name="location"/>
                                        <field name="image" widget="image"/>
                                    </group>
                                </form>
                            </field>
                        </page>
                    </notebook>
                    </sheet>
                    <div class="oe_chatter">
                        <field name="message_follower_ids" widget="mail_followers"/>
                        <field name="activity_ids" widget="mail_activity"/>
                        <field name="message_ids" widget="mail_thread"/>
                    </div>
                </form>
            </field>
        </record>
    </data>
</odoo>