<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <data>
        <template id="report_quality_document_detail">
            <t t-call="web.html_container">
                <t t-foreach="docs" t-as="doc">
                    <t t-call="web.external_layout">
                        <div class="page">
                            
                            <h2 class="mt-3" style="text-align: center;">Quality Testing Report: <span t-field="doc.name"/></h2>
                            <div class="row mb-4">
                                <div class="col-6">
                                    <strong>Child Lot:</strong> <span t-field="doc.child_lot_id.name"/><br/>
                                    <strong>Parent Lot:</strong> <span t-field="doc.parent_lot_id.name"/><br/>
                                    <strong>Product:</strong> <span t-field="doc.product_id.display_name"/><br/>
                                    <strong>Lot Quantity:</strong> <span t-field="doc.lot_qty_total"/> <span t-field="doc.uom_id.name"/>
                                </div>
                                <div class="col-6 text-right">
                                    <strong>Testing Date:</strong> <span t-field="doc.testing_date"/><br/>
                                    <strong>Tested By:</strong> <span t-field="doc.tester_id.name"/><br/>
                                    <strong>Test Location:</strong> <span t-field="doc.test_location_id.display_name"/><br/>
                                    <strong>Status:</strong> <span t-field="doc.state"/>
                                </div>
                            </div>
                            <hr/>

                            <h4>Quality Test Results</h4>
                            
                            <div class="row mb-5"> 
                                <div class="col-6" style="padding-right: 15px;">
                                    <h5>Physical Characteristics</h5>
                                    <table class="table table-sm table-bordered" style="height: 150px;">
                                        <tbody>
                                            <tr style="background-color: #f8f9fa; height: 37.5px;">
                                                <td style="width: 70%; padding: 8px; vertical-align: middle;">Uniform Color:</td>
                                                <td style="padding: 8px; vertical-align: middle;"><t t-esc="doc.uniform_color and '✓ Yes' or '✗ No'"/></td>
                                            </tr>
                                            <tr style="background-color: #f8f9fa; height: 37.5px;">
                                                <td style="padding: 8px; vertical-align: middle;">Visible Mold Free:</td>
                                                <td style="padding: 8px; vertical-align: middle;"><t t-esc="doc.visible_mold_free and '✓ Yes' or '✗ No'"/></td>
                                            </tr>
                                            <tr style="background-color: #f8f9fa; height: 37.5px;">
                                                <td style="padding: 8px; vertical-align: middle;">Physical Damage Free:</td>
                                                <td style="padding: 8px; vertical-align: middle;"><t t-esc="doc.physical_damage_free and '✓ Yes' or '✗ No'"/></td>
                                            </tr>
                                            <tr style="background-color: #f8f9fa; height: 37.5px;">
                                                <td style="padding: 8px; vertical-align: middle;">Pest Free:</td>
                                                <td style="padding: 8px; vertical-align: middle;"><t t-esc="doc.pest_free and '✓ Yes' or '✗ No'"/></td>
                                            </tr>
                                        </tbody>
                                    </table>
                                </div>

                                <div class="col-6" style="padding-left: 15px;">
                                    <h5>Quality Attributes</h5>
                                    <table class="table table-sm table-bordered" style="height: 150px;">
                                        <tbody>
                                            <tr style="background-color: #f8f9fa; height: 37.5px;">
                                                <td style="width: 50%; padding: 8px; vertical-align: middle;">Freshness:</td>
                                                <td style="padding: 8px; vertical-align: middle;"><span t-field="doc.freshness"/></td>
                                            </tr>
                                            <tr style="background-color: #f8f9fa; height: 37.5px;">
                                                <td style="padding: 8px; vertical-align: middle;">Texture:</td>
                                                <td style="padding: 8px; vertical-align: middle;"><span t-field="doc.texture"/></td>
                                            </tr>
                                            <tr style="background-color: #f8f9fa; height: 37.5px;">
                                                <td style="padding: 8px; vertical-align: middle;">Aroma:</td>
                                                <td style="padding: 8px; vertical-align: middle;"><span t-field="doc.aroma"/></td>
                                            </tr>
                                            <tr style="background-color: #f8f9fa; height: 37.5px;">
                                                <td style="padding: 8px; vertical-align: middle;">Moisture (%):</td>
                                                <td style="padding: 8px; vertical-align: middle;"><span t-field="doc.moisture"/>%</td>
                                            </tr>
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                            
                            <!-- <h4 class="mt-5" style="text-align: center;">Child Lot Barcode Label</h4>
                            <div class="row justify-content-center mb-5">
                                <div class="col-8">
                                    <div style="border: 1px solid #000; padding: 20px; text-align: center;">
                                        <div style="margin-bottom: 10px;">
                                            <img t-att-src="'/report/barcode/Code128/%s?width=500&amp;height=100' % doc.child_lot_id.name" 
                                            style="max-width: 90%; height: auto;" 
                                            alt="Barcode"/>
                                        </div>
                                        
                                        <div style="font-weight: bold; font-size: 18px; margin-bottom: 5px;">
                                            <span t-field="doc.child_lot_id.name"/>
                                        </div>
                                        
                                        <div style="font-size: 12px;">
                                            Product: <span t-field="doc.product_id.name"/> | Parent Lot: <span t-field="doc.parent_lot_id.name"/>
                                        </div>
                                        <div style="font-size: 12px; font-weight: bold; margin-top: 5px;">
                                            Qty: <span t-field="doc.lot_qty_total"/> kg
                                        </div>
                                        
                                        <div style="font-size: 10px; color: #666; margin-top: 10px;">
                                            Tested: <span t-field="doc.testing_date"/> | Quality Report: <span t-field="doc.name"/>
                                        </div>
                                    </div>
                                </div>
                            </div> -->

                            <!-- CHEMICAL + BARCODE ROW -->
                            <div class="row" style="align-items:flex-start; margin-bottom:10px; margin-top:3rem;">
                                <!-- CHEMICAL CHARACTERISTICS (left) - same visual style as top tables, kept narrow -->
                                <div class="col-5" style="padding-right:6px;">
                                    <h5 style="margin:0 0 6px 0;">Chemical Characteristics</h5>
                                    <!-- <table class="table table-sm table-bordered"
                                        style="height:150px; border-collapse:collapse; font-size:12px; width:100%;">
                                        <tbody>
                                            <tr style="background-color:#f8f9fa; height:37.5px;">
                                                <td style="width:58%; padding:8px; vertical-align:middle;">pH:</td>
                                                <td style="padding:8px; vertical-align:middle;"><t t-esc="('%.2f' % (doc.ph_value or 0.0))"/></td>
                                            </tr>
                                            <tr style="height:37.5px;">
                                                <td style="padding:8px; vertical-align:middle;">Brix:</td>
                                                <td style="padding:8px; vertical-align:middle; text-align:right;"><t t-esc="('%.2f' % (doc.brix_value or 0.0))"/></td>
                                            </tr>
                                            <tr style="background-color:#f8f9fa; height:37.5px;">
                                                <td style="padding:8px; vertical-align:middle;">Ash Content (%):</td>
                                                <td style="padding:8px; vertical-align:middle; text-align:right;"><t t-esc="('%.2f' % (doc.ash_content or 0.0))"/>%</td>
                                            </tr>
                                            <tr style="height:37.5px;">
                                                <td style="padding:8px; vertical-align:middle; font-weight:600; background:#111; color:#fff;">Acid Insoluble Ash (%):</td>
                                                <td style="padding:8px; vertical-align:middle; font-weight:600; background:#111; color:#fff; text-align:right;"><t t-esc="('%.2f' % (doc.acid_insoluble_ash or 0.0))"/>%</td>
                                            </tr>
                                        </tbody>
                                    </table> -->

                                    <table class="table table-sm table-bordered" style="height: 150px;">
                                        <tbody>
                                            <tr style="background-color: #f8f9fa; height: 37.5px;">
                                                <td style="width: 50%; padding: 8px; vertical-align: middle;">pH:</td>
                                                <td style="padding: 8px; vertical-align: middle;"><span t-field="doc.ph_value"/></td>
                                            </tr>
                                            <tr style="background-color: #f8f9fa; height: 37.5px;">
                                                <td style="padding: 8px; vertical-align: middle;">Brix:</td>
                                                <td style="padding: 8px; vertical-align: middle;"><span t-field="doc.brix_value"/></td>
                                            </tr>
                                            <tr style="background-color: #f8f9fa; height: 37.5px;">
                                                <td style="padding: 8px; vertical-align: middle;">Ash Content:</td>
                                                <td style="padding: 8px; vertical-align: middle;"><span t-field="doc.ash_content"/></td>
                                            </tr>
                                            <tr style="background-color: #f8f9fa; height: 37.5px;">
                                                <td style="padding: 8px; vertical-align: middle;">Acid Insoluble Ash:</td>
                                                <td style="padding: 8px; vertical-align: middle;"><span t-field="doc.acid_insoluble_ash"/>%</td>
                                            </tr>
                                        </tbody>
                                    </table>
                                </div>

                                <!-- small spacer to ensure gap between chemical table and barcode box -->
                                <div style="width:12px;"></div>

                                <!-- BARCODE BOX (right area) -->
                                <div class="col-7" style="display:flex; flex-direction:column; align-items:center; padding-left:10px;">
                                    <h4 style="font-size:16px; font-weight:600; text-align:center; margin-bottom:8px;">Child Lot Barcode Label</h4>
                                    <div style="width:100%; max-width:760px; box-sizing:border-box; border:1px solid #000; padding:14px 16px; text-align:center;">
                                        <!-- keep barcode size (do not shrink) -->
                                        <div style="margin-bottom:10px; display:flex; justify-content:center;">
                                            <img t-att-src="'/report/barcode/Code128/%s?width=500&amp;height=100' % doc.child_lot_id.name"
                                                style="display:block; width:auto; height:auto; max-width:100%;" alt="Barcode"/>
                                        </div>

                                        <div style="font-weight:bold; font-size:15px; margin-bottom:6px;">
                                            <span t-field="doc.child_lot_id.name"/>
                                        </div>

                                        <div style="font-size:11.5px; color:#333; margin-bottom:6px;">
                                            Product: <span t-field="doc.product_id.name"/> |
                                            Parent Lot: <span t-field="doc.parent_lot_id.name"/>
                                        </div>

                                        <div style="font-size:12px; font-weight:600; margin-bottom:6px;">
                                            Qty: <span t-field="doc.lot_qty_total"/> <span t-field="doc.uom_id.name"/>
                                        </div>

                                        <div style="font-size:10px; color:#666;">
                                            Tested: <span t-field="doc.testing_date"/> |
                                            Quality Report: <span t-field="doc.name"/>
                                        </div>
                                    </div>
                                </div>
                            </div> <!-- /.row chemical+barcode -->

                            
                            <div style="page-break-before: always;"/>

                            <!-- <t t-if="doc.notes">
                                <h4 class="mt-3">Testing Notes</h4>
                                <div class="alert alert-info" role="alert">
                                    <p><span t-field="doc.notes"/></p>
                                </div>
                            </t> -->

                            <t t-if="doc.notes">
                                <h4 style="margin-top:6px;">Testing Notes</h4>
                                <div class="alert alert-info" style="background:#f0f8ff; padding:10px; border:1px solid #cfe9ff;">
                                    <p style="margin:0;"><span t-field="doc.notes"/></p>
                                </div>
                            </t>

                            <t t-if="doc.image_ids">
                                <h4 class="mt-5">Test Images</h4>
                                <t t-foreach="range(0, len(doc.image_ids), 3)" t-as="i">
                                    <div class="row">
                                        <t t-foreach="doc.image_ids[i:i+3]" t-as="img">
                                            <div class="col-4 mb-4">
                                                <div style="width: 100%; padding-bottom: 75%; position: relative; border: 1px solid #ccc;">
                                                    <img t-attf-src="data:image/png;base64,{{img.image}}" 
                                                         style="position: absolute; top: 0; left: 0; width: 100%; height: 100%; object-fit: cover;"/>
                                                </div>
                                                <p class="text-center mt-2" style="font-size: 0.9em;">
                                                    <strong><span t-field="img.name"/></strong><br/>
                                                    Location: <span t-field="img.location"/>
                                                </p>
                                            </div>
                                        </t>
                                    </div>
                                </t>
                            </t>
                            
                        </div>
                    </t>
                </t>
            </t>
        </template>
    </data>
</odoo>